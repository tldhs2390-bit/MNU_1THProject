<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="${menu != null ? menu.name + ' | メニュー詳細' : 'メニュー詳細'}">メニュー詳細</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="/css/index.css" />
  <link rel="stylesheet" href="/css/menu.css" />

  <style>
    :root{
      --detail-box-height: 560px;
      --detail-box-height-mobile: 420px;
      --frameDeep:#3f2b1d;
    }

    .menu-page.wood-bg{
      position: relative;
      isolation: isolate;
    }
    body.evening .menu-page.wood-bg,
    body.night .menu-page.wood-bg{
      filter:none !important;
    }
    .menu-page.wood-bg::before,
    .menu-page.wood-bg::after{
      pointer-events:none;
    }
    .menu-page.wood-bg > *{
      position: relative;
      z-index: 2;
    }

    .menu-page-wrap a{
      text-decoration:none !important;
      color:inherit;
    }

    .menu-detail-wrap{
      max-width:1120px;
      margin:0 auto;
      display:grid;
      grid-template-columns:1fr;
      gap:20px;
      padding-bottom:30px;
    }
    @media (min-width:980px){
      .menu-detail-wrap{
        grid-template-columns:1fr 1fr;
        align-items:stretch;
      }
    }

    .menu-detail-image{
      height: var(--detail-box-height);
      border:7px solid var(--frameDeep);
      background:#fff;
      box-shadow:0 16px 26px rgba(0,0,0,.22);
      overflow:hidden;
    }
    .menu-detail-image img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .menu-detail-card{
      height: var(--detail-box-height);
      border:7px solid var(--frameDeep);
      background:#fdf7eb;
      box-shadow:0 16px 26px rgba(0,0,0,.22);
      padding:22px;

      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    @media (max-width:760px){
      .menu-detail-image,
      .menu-detail-card{
        height: var(--detail-box-height-mobile);
      }
    }

    .menu-detail-title{
      margin:0;
      font-size:1.8rem;
      font-weight:900;
      font-family:'Yuji Syuku', serif;
      letter-spacing:.06em;
    }

    .menu-detail-price{
      margin-top:6px;
      font-size:1.35rem;
      font-weight:900;
      color:var(--accent);
    }

    .menu-detail-tag{ display:none !important; }

    .menu-detail-desc{
      margin:12px 0 16px;
      padding-top:12px;
      border-top:2px solid rgba(90,63,43,.14);
      font-size:1.05rem;
      line-height:1.85;
      color:var(--ink2);

      flex:1 1 auto;
      overflow:auto;
    }

    .menu-detail-info{
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .detail-row{
      padding:14px 16px;
      background:linear-gradient(180deg,#fdf7eb,#efe5d2);
      border:3px solid rgba(90,63,43,.22);
      font-size:1rem;
    }

    .detail-row strong{
      color:var(--accent);
      font-weight:900;
      margin-right:6px;
    }

    /* ✅ 원산지 줄바꿈 표시용 */
    .origin-lines{
      margin-top:8px;
    }
    .origin-line{
      line-height:1.75;
      color:var(--ink2);
    }
    .origin-line + .origin-line{
      margin-top:6px;
    }

    /* ✅✅✅ 예약 페이지와 동일한 breadcrumb 스타일 그대로 */
    .breadcrumb {
      position: absolute;
      top: 96px;
      left: 0;
      width: 100%;
      padding: 12px 60px;
      background: transparent;
      z-index: 60;

      font-size: 17px;
      color: #111;
      text-align: left;
    }

    .breadcrumb a {
      color: #111;
      text-decoration: none;
      opacity: 0.6;
    }

    .breadcrumb a:hover {
      opacity: 1;
      text-decoration: underline;
    }

    .breadcrumb .current {
      color: #111;
      font-weight: 600;
    }

    /* ✅ breadcrumb 공간 확보 (reserve-section과 동일한 의도)
       - menu.css의 padding을 깨지 않게 최소한으로만 추가 */
    .menu-page{
      padding-top: 120px; /* breadcrumb 공간 */
    }

    .menu-page-wrap footer{
      text-align:center;
      padding:40px 0;
      font-size:12px;
      opacity:.85;
    }
  </style>
</head>

<body id="time-theme">
<div class="menu-page-wrap">

<header class="top-bar wood-header">
  <a href="/" class="logo brand-area">
    <img src="/images/logo-brand.png" class="brand-logo neon-logo" alt="">
    <img src="/images/logo-sion-neon.svg" class="brand-text" alt="">
  </a>
  <nav>
    <a href="/menu">メニュー</a>
    <a href="/#service">サービス</a>
    <a href="/#campaign">キャンペーン</a>
  </nav>

  <div class="wood-header-shadow"></div>
</header>

<!-- ✅✅✅ 예약 페이지와 같은 breadcrumb로 교체 -->
<div class="breadcrumb">
  <a href="/">ホーム</a>
  <span>/</span>
  <a href="/menu">メニュー</a>
  <span>/</span>
  <span class="current" th:text="${menu != null ? menu.name : '詳細'}">詳細</span>
</div>

<section class="menu-page wood-bg">
  <div class="menu-page-head">
    <h1>メニュー</h1>
  </div>

  <div class="menu-detail-wrap">

    <!-- IMAGE -->
    <div class="menu-detail-image">
      <img th:src="${menu.imageUrl != null and menu.imageUrl != '' ? menu.imageUrl : '/images/menu/no-image.png'}"
           th:alt="${menu.name}">
    </div>

    <!-- INFO -->
    <div class="menu-detail-card">
      <h2 class="menu-detail-title" th:text="${menu.name}">メニュー名</h2>
      <div class="menu-detail-price" th:text="${menu.priceText}">¥0（税込）</div>

      <p class="menu-detail-desc"
         th:if="${menu.description != null and menu.description != ''}"
         th:text="${menu.description}"></p>

      <div class="menu-detail-info"
           th:if="${(menu.originText != null and menu.originText != '') or (menu.allergyText != null and menu.allergyText != '')}">

        <!-- ✅ 原産地 -->
        <div class="detail-row detail-row--origin"
             th:if="${menu.originText != null and menu.originText != ''}">
          <div class="detail-head">
            <strong class="detail-label">原産地</strong>
          </div>

          <div class="detail-body detail-body--text"
               th:with="o=${menu.originText},
                        hasBullet=${#strings.contains(o,'•')},
                        hasDot=${#strings.contains(o,'・')}">

            <!-- 1) '•' 기준 -->
            <div class="origin-lines" th:if="${hasBullet}">
              <div class="origin-line"
                   th:each="part : ${#strings.arraySplit(o,'•')}"
                   th:if="${#strings.trim(part) != ''}"
                   th:text="${'•' + #strings.trim(part)}">•日本: 牛肉</div>
            </div>

            <!-- 2) '・' 기준 -->
            <div class="origin-lines" th:if="${!hasBullet and hasDot}">
              <div class="origin-line"
                   th:each="part : ${#strings.arraySplit(o,'・')}"
                   th:if="${#strings.trim(part) != ''}"
                   th:text="${'・' + #strings.trim(part)}">・日本: 牛肉</div>
            </div>

            <!-- 3) 점이 없으면 그대로 -->
            <div th:if="${!hasBullet and !hasDot}"
                 th:text="${o}">日本: 牛肉・玉ねぎ</div>

          </div>
        </div>

        <!-- ✅ アレルギー -->
        <div class="detail-row detail-row--allergy"
             th:if="${menu.allergyText != null and menu.allergyText != ''}">
          <div class="detail-head">
            <strong class="detail-label">アレルギー</strong>
            <span class="detail-sub">含有成分</span>
          </div>

          <div class="chip-list"
               th:with="a=${#strings.replace(menu.allergyText, '、', '・')},
                        b=${#strings.replace(a, ',', '・')}">
            <span class="chip"
                  th:each="item : ${#strings.arraySplit(b, '・')}"
                  th:if="${#strings.trim(item) != ''}"
                  th:text="${#strings.trim(item)}">小麦</span>
          </div>
        </div>

      </div>
    </div>

  </div>
</section>

<footer>© 酒屋 シオン</footer>

<script>
(function(){
  const h=new Date().getHours();
  const b=document.getElementById("time-theme");
  if(h>=18&&h<21)b.classList.add("evening");
  else if(h>=21||h<5)b.classList.add("night");
})();
</script>

</div>
</body>
</html>