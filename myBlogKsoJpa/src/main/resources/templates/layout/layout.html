<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:fragment="layout(content)">

<head>
    <meta charset="UTF-8">
    <title>MyBlogKso</title>
    <link rel="stylesheet" th:href="@{/css/main.css}"> <!-- 기존 블로그 배경, 스타일 유지 -->

    <!-- jQuery는 layout에만 한 번 로드 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body>
<div class="page-wrapper">

    <!-- 상단 영역 -->
    <div class="top-wrapper">
        <header>
            <div class="header-inner">
                <a th:href="@{/}" class="logo">MyBlogKso</a>
            </div>
        </header>

        <nav>
    <ul>
        <!-- 로그인 안 된 상태 -->
        <li th:if="${session.user == null}">
            <a th:href="@{/user/user_terms}">회원가입</a>
        </li>

        <!-- 일반 로그인 사용자 -->
        <li th:if="${session.user != null and !session.user.admin}">
            <a th:href="@{/user/user_delete}">회원탈퇴</a>
        </li>

        

        <!-- 게시판 목록 -->
        <li><a th:href="@{/board/board_list}">공지사항</a></li>
        <li><a th:href="@{/portfolio/portfolio_list}">포트폴리오</a></li>
        <li><a th:href="@{/question/question_list}">Q/A 게시판</a></li>
    </ul>
</nav>

        <img src="/img/ksophoto(2).jpeg" alt="프로필 사진" class="profile-img">
    </div>

    <main>
        <div class="main-layout" >

            <aside class="sidebar">
    <div class="login-box">
        <div th:if="${session.user == null}">
            <h3>로그인</h3>
            <form th:action="@{/user/user_login}" method="post" id="sidebarLoginForm">
                <input type="text" name="userid" placeholder="아이디" class="board-input" required>
                <input type="password" name="passwd" placeholder="비밀번호" class="board-input" required>
                <button type="submit" class="board-list-btn-alt">로그인</button>
            </form>
        </div>

        <div th:if="${session.user != null}">
    <h3>MyBlogKso에 오신 것을</h3>
    <h3>환영합니다!</h3>
    
    <!-- 관리자 이름 -->
    <p th:if="${session.user.admin}">
        사용자 이름: <span th:text="${session.user.name}">관리자</span>
    </p>
    
    <!-- 일반 사용자 이름 (마스킹) -->
    <p th:unless="${session.user.admin}">
        사용자 이름: 
        <span th:text="${session.user.name.substring(0,1)} + '*' + ${session.user.name.substring(session.user.name.length() - 1)}">
            사용자 이름
        </span>
    </p>
    
    <!-- 관리자 아이디 -->
    <p th:if="${session.user.admin}">
        작성자(아이디): <span>관리자</span>
    </p>
    
    <!-- 일반 사용자 아이디 -->
    <p th:unless="${session.user.admin}">
        작성자(아이디): <span th:text="${session.user.userid}">userid</span>
    </p>
    
    <form th:action="@{/user/user_logout}" method="post" style="margin-top:15px;">
        <button type="submit" class="board-list-btn-alt" style="background-color:#f44336;">로그아웃</button>
    </form>
</div>
    </div>
</aside>

<!-- 로그인 성공/실패 알림 및 리다이렉트 -->
<script th:inline="javascript">
/*<![CDATA[*/
    var row = /*[[${row}]]*/ 0; // 컨트롤러에서 model.addAttribute("row", ...)로 전달된 값
    if(row === 1){
        alert("로그인 성공!");
        window.location.href = /*[[@{/}]]*/ "/";
    } else if(row === 0){
        alert("비밀번호가 틀렸습니다.");
    } else if(row === -1){
        alert("아이디가 존재하지 않습니다.");
    }
/*]]>*/
</script>

            <!-- 콘텐츠 영역 -->
            <section class="page-content">
                <div th:replace="${content}"></div>
            </section>

        </div>
    </main>

    <footer>
        <p>© 2026 myBlogKso</p>
    </footer>

</div>
</body>
</html>